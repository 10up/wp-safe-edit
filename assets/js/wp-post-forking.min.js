/*! WP Safe Edit - v0.1.0
 * https://github.com/10up/WP-Safe-Edit
 * Copyright (c) 2017; * Licensed MIT */
!function(a,b,c){"use strict";function d(){return p||(p=a(document.getElementById("post_ID")).val()||0),p}function e(){return q||(q=void 0!==b.autosaveL10n&&b.autosaveL10n.blog_id),q}function f(){return m||(m=document.querySelector("form#post")),m}function g(){if(!n){var a=f();if(!a)return;n=a.querySelector("input[name=action]")}return n}function h(){var a=d(),b=i();a&&b&&(b=JSON.parse(b),b.hasOwnProperty("post_"+a)&&(delete b["post_"+a],j(b)))}function i(){var a=e();if(b.sessionStorage&&a)return b.sessionStorage.getItem("wp-autosave-"+a)}function j(a){var c=e();if(b.sessionStorage&&c){var d="wp-autosave-"+c;b.sessionStorage.setItem(d,JSON.stringify(a))}}function k(){if(!o){var a=f();if(!a)return;o=a.querySelector(".wpse-spinner")}return o}function l(){var b=k();b&&a(b).addClass("is-active")}var m=null,n=null,o=null,p=0,q=0,r=function(){this.forkButton=null},s=function(){this.mergeButton=null};r.prototype={init:function(){var b=this;a(document).ready(function(){b.setupEvents(),b.setupLockDialog()})},setupEvents:function(){this.forkButton=this.getForkButton(),this.forkButton&&a(this.forkButton).on("click",a.proxy(this.didClickForkButton,this))},setupLockDialog:function(){if(this.lockDialog=this.getLockDialog(),this.lockDialog){var b=a(this.lockDialog).find(".notification-dialog");if(0===b.length)return;b.find(".wp-tab-first").focus(),a(".notification-dialog-background").on("click",function(a){b.find(".wp-tab-first").focus(),a.preventDefault()}),b.on("keydown",function(b){if(9===b.which){var c=a(b.target);c.hasClass("wp-tab-first")&&b.shiftKey?(a(this).find(".wp-tab-last").focus(),b.preventDefault()):c.hasClass("wp-tab-last")&&!b.shiftKey&&(a(this).find(".wp-tab-first").focus(),b.preventDefault())}}).filter(":visible").find(".wp-tab-first").focus()}},getLockDialog:function(){return this.lockDialog||(this.lockDialog=document.getElementById("wpse-lock-dialog")),this.lockDialog},getForkButton:function(){return this.forkButton||(this.forkButton=document.getElementById("wpse-fork-post-button")),this.forkButton},didClickForkButton:function(a){var b=f(),c=g();if(!b||!c)return a.preventDefault(),!1;c.setAttribute("value","fork_post"),h(),l()}},s.prototype={init:function(){var b=this;a(document).ready(function(){b.setupEvents()})},setupEvents:function(){this.mergeButton=this.getMergeButton(),this.mergeButton&&a(this.mergeButton).on("click",a.proxy(this.didClickMergeButton,this))},getMergeButton:function(){return this.mergeButton||(this.mergeButton=document.getElementById("wpse-merge-post-button")),this.mergeButton},didClickMergeButton:function(a){var b=f(),c=g();if(!b||!c)return a.preventDefault(),!1;c.setAttribute("value","merge_post"),h(),l()}},(new r).init(),(new s).init()}(jQuery,this);