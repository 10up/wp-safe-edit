/*! WP Post Forking - v0.1.0
 * https://github.com/10up/post-forking
 * Copyright (c) 2017; * Licensed MIT */
!function(a,b,c){"use strict";function d(){return m||(m=a(document.getElementById("post_ID")).val()||0),m}function e(){return n||(n=void 0!==b.autosaveL10n&&b.autosaveL10n.blog_id),n}function f(){return k||(k=document.querySelector("form#post")),k}function g(){if(!l){var a=f();l=a.querySelector("input[name=action]")}return l}function h(){var a=d(),b=i();a&&b&&(b=JSON.parse(b),b.hasOwnProperty("post_"+a)&&(delete b["post_"+a],j(b)))}function i(){var a=e();if(b.sessionStorage&&a)return b.sessionStorage.getItem("wp-autosave-"+a)}function j(a){var c=e();if(b.sessionStorage&&c){var d="wp-autosave-"+c;b.sessionStorage.setItem(d,JSON.stringify(a))}}var k=null,l=null,m=0,n=0,o=function(){this.forkButton=null},p=function(){this.mergeButton=null};o.prototype={init:function(){var b=this;a(document).ready(function(){b.setupEvents(),b.setupLockDialog()})},setupEvents:function(){this.forkButton=this.getForkButton(),this.forkButton&&a(this.forkButton).on("click",a.proxy(this.didClickForkButton,this))},setupLockDialog:function(){if(this.lockDialog=this.getLockDialog(),this.lockDialog){var b=a(this.lockDialog).find(".notification-dialog");if(0===b.length)return;b.find(".wp-tab-first").focus(),a(".notification-dialog-background").on("click",function(a){b.find(".wp-tab-first").focus(),a.preventDefault()}),b.on("keydown",function(b){if(9===b.which){var c=a(b.target);c.hasClass("wp-tab-first")&&b.shiftKey?(a(this).find(".wp-tab-last").focus(),b.preventDefault()):c.hasClass("wp-tab-last")&&!b.shiftKey&&(a(this).find(".wp-tab-first").focus(),b.preventDefault())}}).filter(":visible").find(".wp-tab-first").focus()}},getLockDialog:function(){return this.lockDialog||(this.lockDialog=document.getElementById("pf-lock-dialog")),this.lockDialog},getForkButton:function(){return this.forkButton||(this.forkButton=document.getElementById("pf-fork-post-button")),this.forkButton},didClickForkButton:function(a){var b=f(),c=g();if(!b||!c)return a.preventDefault(),!1;c.setAttribute("value","fork_post"),h()}},p.prototype={init:function(){var b=this;a(document).ready(function(){b.setupEvents()})},setupEvents:function(){this.mergeButton=this.getMergeButton(),this.mergeButton&&a(this.mergeButton).on("click",a.proxy(this.didClickMergeButton,this))},getMergeButton:function(){return this.mergeButton||(this.mergeButton=document.getElementById("pf-merge-post-button")),this.mergeButton},didClickMergeButton:function(a){var b=f(),c=g();if(!b||!c)return a.preventDefault(),!1;c.setAttribute("value","merge_post"),h()}},(new o).init(),(new p).init()}(jQuery,this);